@page "/checkout"
@rendermode InteractiveServer
@using NovellaMart.Core.BL.Model_Classes
@using NovellaMart.Core.BL.Services
@inject CartService CartService
@inject NavigationManager NavManager

<div class="page-title">
    <h1>Checkout</h1>
    <div class="title-underline"></div>
    <p class="title-subtext">Finish your order to get your premium care.</p>
</div>

<div class="checkout-layout">

    <!-- LEFT COLUMN: Input Forms -->
    <div class="details-side">

        <!-- Billing Info (Default Cyan Accent) -->
        <div class="checkout-card">
            <div class="checkout-header">
                <i class="fas fa-map-marker-alt"></i>
                Shipping Information
            </div>

            <div class="form-row">
                <div class="form-field">
                    <label>First Name</label>
                    <input type="text" placeholder="e.g. Sarah" class="form-input" />
                </div>
                <div class="form-field">
                    <label>Last Name</label>
                    <input type="text" placeholder="e.g. Jenkins" class="form-input" />
                </div>
            </div>

            <div class="form-field mb-medium">
                <label>Address</label>
                <input type="text" placeholder="123 Wellness Blvd, Apt 4" class="form-input" />
            </div>

            <div class="form-row">
                <div class="form-field">
                    <label>City</label>
                    <input type="text" placeholder="New York" class="form-input" />
                </div>
                <div class="form-field">
                    <label>Postal Code</label>
                    <input type="text" placeholder="10001" class="form-input" />
                </div>
            </div>

            <div class="form-row">
                <div class="form-field">
                    <label>Phone</label>
                    <input type="text" placeholder="+1 (555) 000-0000" class="form-input" />
                </div>
                <div class="form-field">
                    <label>Email</label>
                    <input type="email" placeholder="sarah@example.com" class="form-input" />
                </div>
            </div>
        </div>

        <!-- Payment Method (Yellow Accent) -->
        <div class="checkout-card accent-yellow">
            <div class="checkout-header">
                <i class="fas fa-wallet"></i>
                Payment Method
            </div>

            <div class="payment-selector">
                <!-- Option 1: COD -->
                <div class="payment-item @(paymentMethod == "cod" ? "active" : "")"
                     @onclick='() => paymentMethod = "cod"'>
                    <div style="display:flex; align-items:center;">
                        <div class="radio-custom"></div>
                        <span style="font-weight: 600;">Cash on Delivery</span>
                    </div>
                    <i class="fas fa-money-bill-wave payment-icon-cod"></i>
                </div>

                <!-- Option 2: Card (Mock) -->
                <div class="payment-item @(paymentMethod == "card" ? "active" : "")"
                     @onclick='() => paymentMethod = "card"'>
                    <div style="display:flex; align-items:center;">
                        <div class="radio-custom"></div>
                        <span style="font-weight: 600;">Credit / Debit Card</span>
                    </div>
                    <div class="payment-icon-card">
                        <i class="fab fa-cc-visa"></i> <i class="fab fa-cc-mastercard"></i>
                    </div>
                </div>
            </div>

            <!-- Fake Card Form (Shows if Card selected) -->
            @if (paymentMethod == "card")
            {
                <div class="card-form-container">
                    <div class="form-field mb-small">
                        <label>Card Number</label>
                        <input type="text" placeholder="0000 0000 0000 0000" class="form-input" />
                    </div>
                    <div class="form-row">
                        <div class="form-field">
                            <label>Expiry</label>
                            <input type="text" placeholder="MM/YY" class="form-input" />
                        </div>
                        <div class="form-field">
                            <label>CVC</label>
                            <input type="text" placeholder="123" class="form-input" />
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>

    <!-- RIGHT COLUMN: Order Summary (Yellow Accent) -->
    <div class="summary-side">
        <div class="checkout-card accent-yellow">
            <h3 style="margin-top:0; font-size: 1.2rem; font-weight: 700;">Order Summary</h3>

            <div class="summary-product-list">
                @{
                    var cart = CartService.GetCart();
                    var node = cart.items.head;
                }

                @while (node != null)
                {
                    var item = node.Data;
                    <div class="mini-product">
                        @if (item.Product.images.Length > 0)
                        {
                            <img src="@item.Product.images[0]" class="mini-img" />
                        }
                        <div class="mini-details">
                            <div class="mini-name">@item.Product.name</div>
                            <div class="mini-qty">Qty: @item.Quantity</div>
                        </div>
                        <div class="mini-price">$@(item.Product.price* item.Quantity)</div>
                    </div>
                    node = node.Next;
                }
            </div>

            <div class="price-row">
                <span>Subtotal</span>
                <span style="font-weight: 600;">$@CartService.GetTotalAmount()</span>
            </div>
            <div class="price-row">
                <span>Shipping</span>
                <span class="text-free">Free</span>
            </div>
            <div class="price-row">
                <span>Tax (Estimated)</span>
                <span>$0.00</span>
            </div>

            <div class="price-row total">
                <span>Total</span>
                <span>$@CartService.GetTotalAmount()</span>
            </div>

            <button type="button" class="btn-place-order" @onclick="PlaceOrder">
                Place Order <i class="fas fa-check-circle icon-spacing"></i>
            </button>

            <div class="secure-footer">
                <i class="fas fa-lock"></i> Secure SSL Encryption
            </div>
        </div>
    </div>

</div>

@code {
    private string paymentMethod = "cod"; // Default

    private async Task PlaceOrder()
    {
        // Frontend Only logic for now
        await Task.Delay(500);
        NavManager.NavigateTo("/");
    }
}