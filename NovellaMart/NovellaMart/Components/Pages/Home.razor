@page "/"
@inject NavigationManager Nav
@inject NovellaMart.Core.BL.Services.ProductCatalogService CatalogService
@using NovellaMart.Core.BL.Data_Structures
@using NovellaMart.Core.BL.Model_Classes

<PageTitle>Home - NovellaMart</PageTitle>

<div class="home-container">

    <section class="hero-section">
        <div class="hero-content">
            <span class="hero-subtitle">UP TO 30% OFF NEW ARRIVALS</span>
            <h1 class="hero-title">Find Your Sparkle. <br /> Own Your Style.</h1>
            <p class="hero-text">Discover the latest trends in women's fashion and accessories.</p>

            <a href="shop" class="btn btn-primary btn-lg hero-btn">SHOP NOW</a>
        </div>
    </section>

    <section class="section-pad categories-section">
        <h3 class="section-title text-center">Shop By Category</h3>
        <div class="categories-grid">
            <a href="skincare" class="cat-circle-item">
                <img src="https://via.placeholder.com/300x300/f17fb2/ffffff?text=Skincare" class="cat-img">
                <div class="cat-overlay"><span class="cat-name">Skincare</span></div>
            </a>
            <a href="cosmetics" class="cat-circle-item">
                <img src="https://via.placeholder.com/300x300/5ff4ef/ffffff?text=Makeup" class="cat-img">
                <div class="cat-overlay"><span class="cat-name">Makeup</span></div>
            </a>
            <a href="woman-wear" class="cat-circle-item">
                <img src="https://via.placeholder.com/300x300/f1ee56/333333?text=Wear" class="cat-img">
                <div class="cat-overlay"><span class="cat-name">Woman Wear</span></div>
            </a>
            <a href="accessories" class="cat-circle-item">
                <img src="https://via.placeholder.com/300x300/D4AF37/ffffff?text=Accessories" class="cat-img">
                <div class="cat-overlay"><span class="cat-name">Accessories</span></div>
            </a>
        </div>
    </section>

    <section class="section-pad trending-section bg-light">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3 class="section-title mb-0">Trending Now</h3>
                <a href="shop" class="btn-link-pink">View All <i class="fas fa-arrow-right ms-1"></i></a>
            </div>

            <div class="product-grid-4">
                @if (TrendingList != null && !TrendingList.IsEmpty())
                {
                    var currentNode = TrendingList.head;
                    while (currentNode != null)
                    {
                        var p = currentNode.Data;
                        <div class="product-card">
                            <div class="product-img-wrapper">
                                <img src="@(p.images != null && p.images.Length > 0 ? p.images[0] : "https://via.placeholder.com/300?text=No+Image")"
                                     alt="@p.name" class="product-img">
                                <button class="btn-add-to-cart">ADD TO CART</button>
                            </div>

                            <div class="product-info">
                                <span class="product-cat">@p.category.name</span>
                                <h4 class="product-title"><a href="product/@p.product_id">@p.name</a></h4>
                                <div class="product-price">
                                    <span class="text-primary fw-bold">PKR @p.price.ToString("N0")</span>
                                </div>
                            </div>
                        </div>
                        currentNode = currentNode.Next;
                    }
                }
                else
                {
                    <p class="text-center w-100 py-5">Loading trending styles...</p>
                }
            </div>
        </div>
    </section>
</div>

@code {
    private MyLinkedList<ProductBL> TrendingList = new MyLinkedList<ProductBL>();

    protected override async Task OnInitializedAsync()
    {
        await CatalogService.LoadProductsAsync();

        TrendingList.Clear();
        var node = CatalogService.MasterProductList.head;
        int count = 0;

        while (node != null && count < 4)
        {
            var p = node.Data;
            if (p.tags.FindNode("Trending"))
            {
                TrendingList.InsertAtEnd(p);
                count++;
            }
            node = node.Next;
        }
    }
}